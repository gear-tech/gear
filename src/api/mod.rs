//! gear api
use crate::{
    api::{config::GearConfig, generated::api::RuntimeApi},
    keystore, Result,
};
use subxt::{sp_core::sr25519::Pair, ClientBuilder, PairSigner, PolkadotExtrinsicParams};

mod calls;
pub mod config;
mod constants;
/// Auto generated by subxt-cli-0.21.0
///
/// gear-node 0.1.0-f48450dd-x86_64-linux-gnu
///
/// subxt codegen | rustfmt --edition=2021
pub mod generated;
mod rpc;
mod utils;

const DEFAULT_GEAR_ENDPOINT: &str = "wss://rpc-node.gear-tech.io:443";

/// gear api
pub struct Api {
    api: RuntimeApi<GearConfig, PolkadotExtrinsicParams<GearConfig>>,
    signer: PairSigner<GearConfig, Pair>,
}

impl Api {
    /// New gear api
    pub async fn new(url: Option<&str>, passwd: Option<&str>) -> Result<Self> {
        let api = ClientBuilder::new()
            .set_url(url.unwrap_or(DEFAULT_GEAR_ENDPOINT.into()))
            .build()
            .await?
            .to_runtime_api::<RuntimeApi<GearConfig, PolkadotExtrinsicParams<GearConfig>>>();

        let signer = keystore::cache(passwd.as_ref().map(|s| s.as_ref()))?;

        Ok(Self { api, signer })
    }
}
