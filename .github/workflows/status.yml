name: "Status Check"

on:
  workflow_call:
    outputs:
      build:
        description: "If trigger build."
        value: ${{ jobs.status.outputs.build }}
      cache:
        description: "The path of sccache cache."
        value: ${{ jobs.status.outputs.cache }}
      check:
        description: "If trigger check."
        value: ${{ jobs.status.outputs.check }}
      macos:
        description: "If force macos."
        value: ${{ jobs.status.outputs.macos }}

jobs:
  check:
    runs-on: ubuntu-latest
    outputs:
      build: ${{ steps.config.outputs.build }}
      cache: ${{ steps.sccache.outputs.cache }}
      check: ${{ steps.config.outputs.check }}
      macos: ${{ steps.config.outputs.macos }}
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Commit Message
        id: commit-message
        shell: bash
        run: echo "message=$(git show -s --format=%s)"

      - name: Install deps for the message action.
        run: npm install --production
        working-directory: .github/actions/message

      - name: Configure
        id: config
        with:
          full-name: ${{ github.event.pull_request.head.repo.full_name }}
          head-sha: ${{ github.event.pull_request.head.sha }}
          issue: ${{ github.event.number }}
          message: ${{ steps.commit-message.outputs.message }}
          title: ${{ github.event.pull_request.title }}
        uses: ./.github/actions/message

      - name: Set sccache path
        if: ${{ steps.config.outputs.cache }}
        id: sccache
        run: |
          sccache_path="/mnt/sccache/$(echo ${GITHUB_REF#refs/heads/} | tr / _)"
          echo "cache=$sccache_path" >> $GITHUB_OUTPUT
