name: Label

on:
  pull_request:
    branches: [master, vara-stage-1, vara-stage-2, vara-stage-3]
    types: [labeled]

jobs:
  dispatch:
    runs-on: ubuntu-latest
    if: >-
      github.event.label.name == 'A0-pleasereview'
      || github.event.label.name == 'E2-forcemacos'
      || github.event.label.name == 'A4-insubstantial'
      || github.event.label.name == 'A2-mergeoncegreen'

    steps:
      - uses: actions/checkout@v4

      - uses: gear-tech/fork-action@v0.1.0
        if: github.event.label.name != 'E2-forcemacos'
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          head_sha: ${{ github.event.pull_request.head.sha }}
          ref: ${{ github.head_ref || github.ref_name }}
          repo: "gear-tech/gear"
          workflow_id: ".github/workflows/build.yml"
          prefix: "build"
          jobs: '["linux", "win-cross"]'
          inputs:
            '{ "title": "${{ github.event.pull_request.title }}", "number": "${{
            github.event.number }}" }'

      - uses: gear-tech/fork-action@v0.1.0
        if: github.event.label.name == 'E2-forcemacos'
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          head_sha: ${{ github.event.pull_request.head.sha }}
          ref: ${{ github.head_ref || github.ref_name }}
          repo: "gear-tech/gear"
          workflow_id: ".github/workflows/build-macos.yml"
          prefix: "build"
          jobs: '["x86"]'
