[workspace]
resolver = "2"

default-members = ["node/cli"]

members = [
    "common",
    "common/codegen",
    "core",
    "core-backend/common",
    "core-backend/sandbox",
    "core-backend/wasmi",
    "core-processor",
    "core-errors",
    "examples/binaries/async-custom-entry",
    "examples/binaries/async-signal-entry",
    "examples/binaries/async-tester",
    "examples/binaries/backend-error",
    "examples/binaries/btree",
    "examples/binaries/calc-hash",
    "examples/binaries/compose",
    "examples/binaries/contract-template",
    "examples/binaries/delayed-sender",
    "examples/binaries/distributor",
    "examples/binaries/exit-handle",
    "examples/binaries/exit-handle-sender",
    "examples/binaries/exit-init",
    "examples/binaries/gas-burned",
    "examples/binaries/gasless-wasting",
    "examples/binaries/init-fail-sender",
    "examples/binaries/init-wait",
    "examples/binaries/init-wait-reply-exit",
    "examples/binaries/init-with-value",
    "examples/binaries/meta",
    "examples/binaries/mul-by-const",
    "examples/binaries/ncompose",
    "examples/binaries/new-meta",
    "examples/binaries/node",
    "examples/binaries/out-of-memory",
    "examples/binaries/program-factory",
    "examples/binaries/proxy",
    "examples/binaries/proxy-relay",
    "examples/binaries/proxy-with-gas",
    "examples/binaries/proxy-reservation-with-gas",
    "examples/binaries/reserve-gas",
    "examples/binaries/send-from-reservation",
    "examples/binaries/signal-entry",
    "examples/binaries/sys-calls",
    "examples/binaries/syscall-error",
    "examples/binaries/unchecked-mul",
    "examples/binaries/value-sender",
    "examples/binaries/wait-timeout",
    "examples/binaries/wait_wake",
    "examples/binaries/waiter",
    "examples/binaries/waiting-proxy",
    "galloc",
    "gcli",
    "gclient",
    "gcore",
    "gear-test",
    "gmeta",
    "gsdk",
    "gstd",
    "gsys",
    "gtest",
    "node/cli",
    "node/service",
    "node/authorship",
    "node/testing",
    "pallets/*",
    "runtime/gear",
    "runtime/vara",
    "utils/bags-thresholds",
    "utils/call-gen",
    "utils/gear-runtime-test-cli",
    "utils/runtime-fuzzer",
    "utils/runtime-fuzzer/fuzz",
    "utils/junit-common",
    "utils/node-loader/",
    "utils/regression-analysis",
    "utils/utils",
    "utils/validator-checks",
    "utils/wasm-builder",
    "utils/wasm-gen",
    "utils/wasm-info",
    "utils/wasm-instrument",
    "utils/wasm-proc",
]

[workspace.dependencies]
blake2-rfc = { version = "0.2.18", default-features = false }
codec = { package = "parity-scale-codec", version = "3.4.0", default-features = false }
dlmalloc = { git = "https://github.com/gear-tech/dlmalloc-rust.git", rev = "9135baa", default-features = false }
derive_more = "0.99.17"
enum-iterator = "1.3.0"
env_logger = "0.10"
hashbrown = "0.13.2"
hex = { version = "0.4.3", default-features = false }
hex-literal = "0.3.4"
log = { version = "0.4.17", default-features = false }
primitive-types = { version = "0.12.1", default-features = false }
proptest = "1.1.0"
quote = "1.0.23"
rand = "0.8"
scale-info = { version = "2.3.1", default-features = false }
static_assertions = "1"
syn = "2.0.0"
wabt = "0.10.0"
wasmi = { version = "0.14.0", default-features = false }
wasmparser = { package = "wasmparser-nostd", version = "0.100.1", default-features = false }

# Internal deps
galloc = { path = "galloc" }
gsys = { path = "gsys" }
gear-backend-common = { path = "core-backend/common", default-features = false }
gear-common = { path = "common", default-features = false }
gear-common-codegen = { path = "common/codegen" }
gear-core = { path = "core" }
gear-core-errors = { path = "core-errors" }
gear-runtime-interface = { path = "runtime-interface", default-features = false }
gear-utils = { path = "utils/utils" }
gear-wasm-instrument = { path = "utils/wasm-instrument", default-features = false }

# Substrate deps
sp-core = { version = "7.0.0", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }
sp-io = { version = "7.0.0", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }
sp-runtime = { version = "7.0.0", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }
sp-sandbox = { version = "0.10.0-dev", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }
sp-std = { version = "5.0.0", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }
sp-arithmetic = { version = "6.0.0", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }
frame-support = { version = "4.0.0-dev", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }
frame-system = { version = "4.0.0-dev", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }
frame-benchmarking = { version = "4.0.0-dev", git = "https://github.com/gear-tech/substrate.git", branch = "gear-polkadot-v0.9.38", default-features = false }

[profile.release]
panic = "unwind"

[profile.release.package.gcore]
opt-level = "s"

[profile.release.package.gstd]
opt-level = "s"

[profile.release.package.gear-test]
opt-level = "s"

[profile.release.package.galloc]
opt-level = "s"

[profile.release.package.gtest]
opt-level = "s"

[profile.production]
inherits = "release"

# Sacrifice compile speed for execution speed by using optimization flags:

# https://doc.rust-lang.org/rustc/linker-plugin-lto.html
lto = "fat"
# https://doc.rust-lang.org/rustc/codegen-options/index.html#codegen-units
codegen-units = 1

[patch.crates-io]
# TODO: remove after Substrate update
wasmtime-runtime = { git = "https://github.com/gear-tech/wasmtime", rev = "b16cc8eaf40f95b3b1eec2869c08ccd61bdf65fe" }
wasmtime = { git = "https://github.com/gear-tech/wasmtime", rev = "b16cc8eaf40f95b3b1eec2869c08ccd61bdf65fe" }

# TODO: remove after https://github.com/BLAKE3-team/BLAKE3/pull/230
blake3 = { git = "https://github.com/gear-tech/BLAKE3", branch = "fix-clang-cl-cross" }

# TODO: remove after https://github.com/pepyakin/wabt-rs/pull/84
wabt = { git = "https://github.com/gear-tech/wabt-rs", branch = "al-win-crt" }
